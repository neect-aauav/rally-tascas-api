# NEECT RALLY-TASCAS API
API that handles data to and from neect rally-tascas' databases.

ğŸ”‘ This application uses **API Token Authorization** to access some endpoints (usually, read only HTTP request methods don't require the Token).

Please refer to [Symbol Keys](#symbol-keys) before reading the documentation on the endpoints.

## API Documentation

### Introduction

1. [Make a HTTP Request](#make-a-http-request)
1. [Symbol Keys](#symbol-keys)

### Base Structures and Endpoints

1. [Teams](#teams)
    1. [Structure](#teams-structure)
    1. [Add Team](#add-team)
    1. [Get Team](#get-team)
    1. [Delete Team](#delete-team)
    1. [Update Team](#update-team)
1. [Members](#members)
    1. [Structure](#members-structure)
    1. [Add Member](#add-member)
    1. [Get Member](#get-member)
    1. [Delete Member](#delete-member)
    1. [Update Member](#update-member)
1. [Bars](#bars)
    1. [Structure](#bars-structure)
    1. [Add Bar](#add-bar)
    1. [Get Bar](#get-bar)
    1. [Delete Bar](#delete-bar)
    1. [Update Bar](#update-bar)
1. [Games](#games)
    1. [Structure](#games-structure)
    1. [Add Game](#add-game)
    1. [Get Game](#get-game)
    1. [Delete Game](#delete-game)
    1. [Update Game](#update-game)
1. [Prizes](#prizes)
    1. [Structure](#prizes-structure)
    1. [Add Prize](#add-prize)
    1. [Get Prize](#get-prize)
    1. [Delete Prize](#delete-prize)
    1. [Update Prize](#update-prize)
1. [QR Codes](#qr-codes)
    1. [Generate QR Code](#generate-qr-code)
    1. [Get QR Code](#get-qr-code)
    1. [Delete QR Code](#delete-qr-code)

### Administration    

1. [Admin](#admin)
    1. [Create Admin Account](#create-admin-account)
    1. [Get Admin Token](#get-admin-token)
    1. [Validate Admin Token](#validate-admin-token)

---

## Make a HTTP Request

Every endpoint is accessed through a HTTP Request. The request method is specified in the endpoint's documentation.  
If the request method is `GET`, there is no need for any special authorization and no body is required.  
If the request method is `POST`, `PUT` or `DELETE`, the request body must be a JSON object and the request must be authorized with an API Token, passed in the Header as follows:

```shell
GET /schedule
  -H 'accept: application/json'
  -H 'Authorization: Token {token}'
```
This token can be obtained by creating an admin account and getting the token from the `/api/token` endpoint. See [Get Admin Token](#get-admin-token).

The Responses to any Request is always a JSON. Generaly, upon a successful `GET` request, the response will contain the requested resource(s). Otherwise, the response will contain a message with either confirmation of the action or an error, as follows:

```json5
{
    "status": 400,
    "message": "A team with the name Test already exists"
}
```

---

## Symbol Keys

The following symbols are used in the documentation:

**ğŸ¦¸:** Requires Superuser Authorization  
**ğŸ”‘:** Requires API Token Authorization  
**âœ”:** Applicable  
**âœ–:** Not applicable  
**ğŸ”„:** Automatically generated by the API  
**â€:** Null value

---

## Teams

Teams that compete against each other in the bar hopping event.

***[POST, GET, DELETE, PATCH]***

### Teams Structure

Example of the information fetched from **/teams**:
```json5
{
    "id": 1,
    "name": "Crocodiles",
    "email": "example@example.com",
    "points": 45,
    "drinks": 3,
    "qr_code": "http://127.0.0.1:8000/qrcodes/qr_team1.png",
    "has_egg": true,
    "puked": 2,
    "members": [
        ...
    ],
    "bars": [
        {
            "id": 1,
            "bar": {
                ...
            },
            "points": 30,
            "drinks": 2,
            "has_egg": true,
            "puked": 1,
            "visited": true,
            "won_game": true
        },
        ...
    ]
}
```

#### **Fields**
| ID | Name | Data Type | Default | Description |
|----|------|-----------|:-------:| ----------- |
| **id** | Team ID | integer | ğŸ”„ | Team number identifier | 
| **name** | Name | string | âœ– | Team name | 
| **email** | Email | string | âœ– | Team email |
| **points** | Points | integer | 0 | Total number of points won |
| **drinks** | Drinks | integer | 0 | Total number of drinks |
| **qr_code** | QR Code | string | ğŸ”„ | URL to the team's QR Code image |
| **has_egg** | Has Egg | boolean | true | Whether or not the team still has the egg (unbroken) |
| **puked** | Puked | integer | 0 | Total number of times the team members have puked |
| **members** | Team Members | list<[Member](#Members)> | âœ– | List of members in the team |
| **[bars](#Fields-team-bars)** | Bars | list<{..., [Bar](#Bars)}> | ğŸ”„ | Team stats on each bar |

#### **Fields [team-bars]**
| ID | Name | Data Type | Description |
|----|------|-----------|-------------|
| **id** | Bar ID | integer | Bar number identifier | 
| **bar** | Bar | [Bar](#Bars) | Bar data | 
| **points** | Team Points | integer | Total number of points won on this bar |
| **drinks** | Team Drinks | integer | Total number of drinks on this bar |
| **has_egg** | Has Egg | boolean | Whether or not the team still had the egg on this bar |
| **puked** | Puked | integer | Total number of times the team members have puked on this bar |
| **visited** | Visited | boolean | Whether or not the team has already visited this bar |
| **won_game** | Won Game | boolean | Whether or not the team has won the game on this bar |

### Add Team

Add a new team to the database.

**HTTP Request**

``` POST .../api/teams```  [ğŸ”‘](#make-a-http-request)

**Request Body**
```json5
{
    "team": "Crocodiles",
    "email": "example@example.com",
    "members": [
        {
            "name": "John Doe",
            "nmec": 12345,
            "course": "Computadores e TelemÃ¡tica"
        },
        ...
    ]
}
```

#### **Fields**
| ID | Mandatory | Data Type |
|----|:---------:|-----------|
| **team** | âœ” | string |
| **email** | âœ” | string |
| **members** | âœ” | list<[Member](#Members)> |

### Get Team

Get teams from the database.  
If no team ID is specified, all teams are returned.  
URL parameters can be used to get teams by other fields.  
Accepted URL parameters are: **name**, **email**, **id**.

**HTTP Request**

``` GET .../api/teams```  
``` GET .../api/teams/{team_id}```  
``` GET .../api/teams?name={team_name}```

**Response Body**

See [Structure](#teams-structure)

### Delete Team

Delete a team from the database.  
Must specify the team ID.

**HTTP Request**

``` DELETE .../api/teams/{team_id}``` [ğŸ”‘](#make-a-http-request)

### Update Team

Update a team's information.  
Provide the team ID and the fields to be updated.  
Unspecified fields will be left unchanged.  
Updatable fields are: ***name, email, points, drinks, has_egg, puked***

**HTTP Request**

``` PATCH .../api/teams/{team_id}``` [ğŸ”‘](#make-a-http-request)

---

## Members

Members that are part of a team

***[POST, GET, DELETE, PATCH]***

### Members Structure

Example of the information fetched from **/members**:
```json5
{
    "id": 1,
    "name": "John Doe",
    "nmec": 12345,
    "course": "Computadores e TelemÃ¡tica",
    "points": 15,
    "drinks": 1,
    "team": {
        ...
    },
    "bars": {
        "id": 1,
        "bar": {
            ...
        },
        "points": 15,
        "drinks": 1
    }
}
```

#### **Fields**
| ID | Name | Data Type | Default | Description |
|----|------|-----------|:-------:| ----------- |
| **id** | Member ID | integer | ğŸ”„ | Member number identifier |
| **name** | Name | string | âœ– | Member name |
| **nmec** | NMEC | integer | âœ– | Member NMEC |
| **course** | Course | string | âœ– | Member course |
| **points** | Points | integer | 0 | Total number of points won |
| **drinks** | Drinks | integer | 0 | Total number of drinks |
| **team** | Team | [Team](#Teams) | âœ– | Data from the member's team |
| **[bars](#Fields-member-bars)** | Bars | list<{..., [Bar](#Bars)}> | ğŸ”„ | Member stats on each bar |

#### **Fields [member-bars]**
| ID | Name | Data Type | Description |
|----|------|-----------|-------------|
| **id** | Bar ID | integer | Bar number identifier |
| **bar** | Bar | [Bar](#Bars) | Bar data |
| **points** | Member Points | integer | Total number of points won on this bar |
| **drinks** | Member Drinks | integer | Total number of drinks on this bar |

### Add Member

Add a new member to the database.

**HTTP Request**

``` POST .../api/members``` [ğŸ”‘](#make-a-http-request)

**Request Body**
```json5
{
    "name": "John Doe",
    "nmec": 12345,
    "course": "Computadores e TelemÃ¡tica",
    "team": 1
}
```

#### **Fields**
| ID | Mandatory | Data Type |
|----|:---------:|-----------|
| **name** | âœ” | string |
| **nmec** | âœ” | integer |
| **course** | âœ” | string |
| **team** | âœ” | integer |

### Get Member

Get members from the database. 
If no member ID is specified, all members are returned.  
URL parameters can be used to get teams by other fields.  
Accepted URL parameters are: **name**, **nmec**, **id**, **course**.

**HTTP Request**

``` GET .../api/members```  
``` GET .../api/members/{member_id}```  
``` GET .../api/members?name={member_name}```

**Response Body**

See [Structure](#members-structure)

### Delete Member

Delete a member from the database.
Must specify the member ID.

**HTTP Request**

``` DELETE .../api/members/{member_id}``` [ğŸ”‘](#make-a-http-request)

### Update Member

Update a member's information.  
Provide the member ID and the fields to be updated.  
Unspecified fields will be left unchanged.  
Updatable fields are: ***name, nmec, course, team, points, drinks***

**HTTP Request**

``` PATCH .../api/members/{member_id}``` [ğŸ”‘](#make-a-http-request)

---

## Bars

Bars that are part of the bar hopping course.

***[POST, GET, DELETE, PATCH]***

### Bars Structure

Example of the information fetched from **/bars**:
```json5
{
    "id": 1,
    "name": "Bar 1",
    "address": "Rua 1",
    "latitude": 38.736946,
    "longitude": -9.142685,
    "picture": "http://127.0.0.1/bar1.jpg",
    "points": 45,
    "drinks": 3,
    "puked": 1,
    "visited": 2,
    "game": {
        ...
    }
}
```

#### **Fields**
| ID | Name | Data Type | Default | Description |
|----|------|-----------|:-------:| ----------- |
| **id** | Bar ID | integer | ğŸ”„ | Bar number identifier |
| **name** | Name | string | âœ– | Bar name |
| **address** | Address | string | âœ– | Bar address |
| **latitude** | Latitude | double | âœ– | Bar latitude |
| **longitude** | Longitude | double | âœ– | Bar longitude |
| **picture** | Picture | string | â€ | Bar picture |
| **points** | Points | integer | 0 | Total number of points won in the bar |
| **drinks** | Drinks | integer | 0 | Total number of drinks in the bar |
| **puked** | Puked | integer | 0 | Total number of puked drinks in the bar |
| **visited** | Visited | integer | 0 | Total number of visits to the bar |
| **game** | Game | [Game](#Games) | â€ | Data from the bar's game |

### Add Bar

Add a new bar to the database.

**HTTP Request**

``` POST .../api/bars``` [ğŸ”‘](#make-a-http-request)

**Request Body**
```json5
{
    "name": "Bar 1",
    "address": "Rua 1",
    "latitude": 38.736946,
    "longitude": -9.142685,
    "picture": "http://127.0.0.1/bar1.jpg",
    "game": 1
}
```

#### **Fields**
| ID | Mandatory | Data Type |
|----|:---------:|-----------|
| **name** | âœ” | string |
| **address** | âœ” | string |
| **latitude** | âœ” | double |
| **longitude** | âœ” | double |
| **picture** | âœ– | string |
| **game** | âœ– | integer |

### Get Bar

Get bars from the database.  
If no bar ID is specified, all bars are returned.  
URL parameters can be used to get teams by other fields.  
Accepted URL parameters are: **name**, **id**.

**HTTP Request**

``` GET .../api/bars```  
``` GET .../api/bars/{bar_id}```  
``` GET .../api/bars?name={bar_name}```

**Response Body**

See [Structure](#bars-structure)

### Delete Bar

Delete a bar from the database.  
Must specify the bar ID.

**HTTP Request**

``` DELETE .../api/bars/{bar_id}``` [ğŸ”‘](#make-a-http-request)

### Update Bar

Update a bar's information.  
Provide the bar ID and the fields to be updated.  
Unspecified fields will be left unchanged.  
Updatable fields are: ***name, address, latitude, longitude, picture, points, drinks, puked, visited, game***

**HTTP Request**

``` PATCH .../api/bars/{bar_id}``` [ğŸ”‘](#make-a-http-request)

---

## Games

Games that are played in each bar.

***[POST, GET, DELETE, PATCH]***

### Games Structure

Example of the information fetched from **/games**:
```json5
{
    "id": 1,
    "name": "Game 1",
    "description": "Game 1 description",
    "points": 10,
    "completed": 2,
}
```

#### **Fields**
| ID | Name | Data Type | Default | Description |
|----|------|-----------|:-------:| ----------- |
| **id** | Game ID | integer | ğŸ”„ | Game number identifier |
| **name** | Name | string | âœ– | Game name |
| **description** | Description | string | â€ | Game description |
| **points** | Points | integer | âœ– | Total number of points a team can win by completing the game |
| **completed** | Completed | integer | 0 | Total number of times the game has been completed |

### Add Game

Add a new game to the database.

**HTTP Request**

``` POST .../api/games``` [ğŸ”‘](#make-a-http-request)

**Request Body**
```json5
{
    "name": "Game 1",
    "description": "Game 1 description",
    "points": 10
}
```

#### **Fields**
| ID | Mandatory | Data Type |
|----|:---------:|-----------|
| **name** | âœ” | string |
| **description** | âœ– | string |
| **points** | âœ” | integer |

### Get Game

Get games from the database.  
If no game ID is specified, all games are returned.  
URL parameters can be used to get teams by other fields.  
Accepted URL parameters are: **name**, **id**, **points**.

**HTTP Request**

``` GET .../api/games```  
``` GET .../api/games/{game_id}```  
``` GET .../api/games?name={game_name}```

**Response Body**

See [Structure](#games-structure)

### Delete Game

Delete a game from the database.  
Must specify the game ID.

**HTTP Request**

``` DELETE .../api/games/{game_id}``` [ğŸ”‘](#make-a-http-request)

### Update Game

Update a game's information.  
Provide the game ID and the fields to be updated.  
Unspecified fields will be left unchanged.  
Updatable fields are: ***name, description, points, completed***

**HTTP Request**

``` PATCH .../api/games/{game_id}``` [ğŸ”‘](#make-a-http-request)

---

## Prizes

Prizes for the best teams.  
A scoreboard position for the prize to be awarded must be specified.

***[POST, GET, DELETE, PATCH]***

### Prizes Structure

Example of the information fetched from **/prizes**:
```json5
{
    "id": 1,
    "name": "Prize 1",
    "place": 1,
    "ammount": 2,
    "winner": 4
}
```

#### **Fields**
| ID | Name | Data Type | Default | Description |
|----|------|-----------|:-------:| ----------- |
| **id** | Prize ID | integer | ğŸ”„ | Prize number identifier |
| **name** | Name | string | âœ– | Prize name |
| **place** | Place | integer | âœ– | Scoreboard position where the prize is awarded |
| **ammount** | Ammount | integer | âœ– | Number of prize items awarded to the winning team |
| **winner** | Winning team | [Team](#teams) | â€ | Team that won the prize |

### Add Prize

Add a new prize to the database.

**HTTP Request**

``` POST .../api/prizes``` [ğŸ”‘](#make-a-http-request)

**Request Body**
```json5
{
    "name": "Prize 1",
    "place": 1,
    "ammount": 2
}
```

#### **Fields**

| ID | Mandatory | Data Type |
|----|:---------:|-----------|
| **name** | âœ” | string |
| **place** | âœ” | integer |
| **ammount** | âœ” | integer |

### Get Prize

Get prizes from the database.  
If no prize ID is specified, all prizes are returned.  
URL parameters can be used to get teams by other fields.  
Accepted URL parameters are: **name**, **id**, **place**, **ammount**.

**HTTP Request**

``` GET .../api/prizes```  
``` GET .../api/prizes/{prize_id}```  
``` GET .../api/prizes?name={prize_name}```

**Response Body**

See [Structure](#prizes-structure)

### Delete Prize

Delete a prize from the database.  
Must specify the prize ID.

**HTTP Request**

``` DELETE .../api/prizes/{prize_id}``` [ğŸ”‘](#make-a-http-request)

### Update Prize

Update a prize's information.  
Provide the prize ID and the fields to be updated.  
Unspecified fields will be left unchanged.  
Updatable fields are: ***name, place, ammount, winner***

**HTTP Request**

``` PATCH .../api/prizes/{prize_id}``` [ğŸ”‘](#make-a-http-request)

---

## QR Codes

Each team has a QR code that can be scanned to add points to the team's score.  
The QR code is generated automatically when a team is created and its png is saved in ***/static/qrcodes/***.  
Only authorized accounts can scan the QR code successfully.  

***[POST, GET, DELETE]***

### Generate QR Code

Generate a QR code for a team.  
This is only used when, for some reason, the qr code image is lost or deleted.

**HTTP Request**

``` POST .../api/qrcodes/{team_id}``` [ğŸ”‘](#make-a-http-request)

### Get QR Code

Get the image of the QR code for a team.
Must specify the team ID.

**HTTP Request**

``` GET .../api/qrcodes/{team_id}```

**Response Body**

The image of the QR code.

### Delete QR Code

Delete a QR code from the database.  
Must specify the team ID.

**HTTP Request**

``` DELETE .../api/qrcodes/{team_id}``` [ğŸ”‘](#make-a-http-request)

---

## Create Admin Account

Create an admin account to manage teams, members, bars, games and prizes.  
Must be superuser to use.

**HTTP Request**

``` POST .../api/register``` ğŸ¦¸[ğŸ”‘](#make-a-http-request)

**Request Body**
```json5
{
    "name": "Admin",
    "nmec": 12345,
    "username": "admin",
    "password": "admin"
}
```

#### **Fields**
| ID | Mandatory | Data Type |
|----|:---------:|-----------|
| **name** | âœ” | string |
| **nmec** | âœ” | integer |
| **username** | âœ” | string |
| **password** | âœ” | string |

---

## Get Admin Token

Get an admin token to use in the Authorization header of requests.

**HTTP Request**

``` POST .../api/login```

**Request Body**
```json5
{
    "username": "admin",
    "password": "admin"
}
```

#### **Fields**
| ID | Mandatory | Data Type |
|----|:---------:|-----------|
| **username** | âœ” | string |
| **password** | âœ” | string |


**Response Body**
```json5
{
    "token": "<random_value>"
}
```

#### **Fields**
| ID | Data Type |
|----|-----------|
| **token** | string |

---

## Validate Admin Token

Check if a token, passed in the body of the request, is valid.

**HTTP Request**

``` POST .../api/token```

**Request Body**
```json5
{
    "token": "<random_value>"
}
```

#### **Fields**
| ID | Mandatory | Data Type |
|----|:---------:|-----------|
| **token** | âœ” | string |

** Response Body**
```json5
{
    "status": 200,
    "message": "Token <random_value> is valid",
    "username": "john",
    "is_superuser": true
}
```